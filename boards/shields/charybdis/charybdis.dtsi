#include <dt-bindings/zmk/matrix_transform.h>
#include <dt-bindings/zmk/input_transform.h>
#include <input/processors.dtsi>

#define INPUT_EV_REL 0x02
#define INPUT_REL_X 0x00
#define INPUT_REL_Y 0x01
#define CHR(row, col) (((row) * 10) + (col))

/ {
    chosen {
        zmk,kscan = &kscan0;
        zmk,matrix_transform = &default_transform;
    };

    default_transform: keymap_transform_0 {
        compatible = "zmk,matrix-transform";
        columns = <10>;
        rows = <4>;
        map = <
            CHR(0,0) CHR(0,1) CHR(0,2) CHR(0,3) CHR(0,4)  CHR(0,5) CHR(0,6) CHR(0,7) CHR(0,8) CHR(0,9)
            CHR(1,0) CHR(1,1) CHR(1,2) CHR(1,3) CHR(1,4)  CHR(1,5) CHR(1,6) CHR(1,7) CHR(1,8) CHR(1,9)
            CHR(2,0) CHR(2,1) CHR(2,2) CHR(2,3) CHR(2,4)  CHR(2,5) CHR(2,6) CHR(2,7) CHR(2,8) CHR(2,9)
                               CHR(3,0) CHR(3,1) CHR(3,2)  CHR(3,5) CHR(3,6)
        >;
    };

    split_inputs {
        #address-cells = <1>;
        #size-cells = <0>;
        trackball_split: trackball_split@0 {
            compatible = "zmk,input-split";
            reg = <0>;
        };
    };

    trackball_listener: trackball_listener {
        compatible = "zmk,input-listener";
        device = <&trackball_split>;
        status = "disabled";
    };
};

&pinctrl {
    spi0_default: spi0_default {
        group1 {
            psels = <NRF_PSEL(SPIM_SCK, 0, 31)>,  // Pin 15
                    <NRF_PSEL(SPIM_MOSI, 0, 17)>, // Pin 2
                    <NRF_PSEL(SPIM_MISO, 0, 22)>; // Pin 1
        };
    };
    spi0_sleep: spi0_sleep {
        group1 {
            psels = <NRF_PSEL(SPIM_SCK, 0, 31)>,
                    <NRF_PSEL(SPIM_MOSI, 0, 17)>,
                    <NRF_PSEL(SPIM_MISO, 0, 22)>;
            low-power-enable;
        };
    };
};
